#!/bin/bash

# Check if the file with unique Resource Groups exists
if [ ! -f "./19/unique_resource_groups.txt" ]; then
    echo "Error: File ./19/unique_resource_groups.txt not found!"
    exit 1
fi

# Ensure the directory ./21/ exists, or create it
mkdir -p ./21/

# Display available Resource Groups
echo "Available Resource Groups:"
echo "-------------------------"
mapfile -t resource_groups < ./19/unique_resource_groups.txt

# Display the list of resource groups and prompt user to select one
for i in "${!resource_groups[@]}"; do
    echo "$((i+1)). ${resource_groups[i]}"
done

# Prompt user to select a Resource Group
read -p "Select a Resource Group by number: " choice

# Validate user choice
if [[ ! "$choice" =~ ^[0-9]+$ ]] || [ "$choice" -lt 1 ] || [ "$choice" -gt "${#resource_groups[@]}" ]; then
    echo "Invalid choice. Exiting..."
    exit 1
fi

# Get the selected Resource Group
selected_rg=${resource_groups[$((choice-1))]}

# Run the Azure commands for the selected Resource Group and save the output
echo "Fetching resources for Resource Group: $selected_rg"
az resource list --resource-group "$selected_rg" --output table | tee ./21/az_resource_list.txt
az containerapp list --resource-group "$selected_rg" --output table | tee ./21/az_containerapp_list.txt
