#!/bin/bash

# Function to display the logo
display_logo() {
  echo "======================================"
  echo "         4SECUREIT.PL                 "
  echo "======================================"
  echo "Cybersecurity & IT Solutions - by : WILAN"
  echo
}

# Function to display the menu
display_menu() {
  echo
  echo "Select the action to perform:"
  echo "======================================"
  echo
  echo "0. Check if domain is Managed in Azure"
  echo "1. Perform DNS and DIG check on domain"
  echo "2. Retrieve Tenant ID for the domain"
  echo "3. Enumerate Azure services for subdomains"
  echo "4. Check if Office 365 user exists"
  echo "5. Generate login list from name and domain"
  echo "6. Check if any user from the list exists"
  echo "7. Check user passwords and save valid ones"
  echo "8. Generate commands for MFA sweep and API authentication"
  echo "9. Display login commands and authenticate"
  echo "10. Retrieve and save Azure access token"
  echo "11. Retrieve and save token for specific service"
  echo "12. Search user mailbox using GraphRunner"
  echo "13. Check conditional access policies"
  echo "14. Display policies with 'Exclude' information"
  echo "15. Retrieve Teams messages and save to file"
  echo "16. Search Teams messages by keyword"
  echo "17. Enumerate Azure subscriptions"
  echo "18. Filter and display Azure resources by resource group"
  echo "19. Display and save resources grouped by resource group"
  echo "20. Display and save Azure resources in a specific resource group"
  echo "21. Display and save Azure container apps in a specific resource group"
  echo "22  Display  container apps info" 
  echo "23. List Key Vaults and Secrets with URIs"
  echo "24. Assign access to Key Vault and retrieve secrets"
  echo "25. Azure SQL Server Explorer"
  echo "26. AzureHound"
  echo "27. RoadRecon"
  echo
  echo "q. Quit"
  echo "======================================"
  echo
}

# Function to run the selected script
run_script() {
  case $1 in
    0)
      ./0-check_domain_azure.sh "$DOMAIN"
      ;;
    1)
      ./1-check_azure_domain.sh "$DOMAIN"
      ;;
    2)
      ./2-check-tenant-id.sh "$DOMAIN"
      ;;
    3)
      ./3-enum-subdomain.sh "$DOMAIN"
      ;;
    4)
      read -p "Enter the email address to check: " EMAIL
      ./4-check_m365_user.sh "$EMAIL"
      ;;
    5)
      read -p "Enter first name: " FIRST_NAME
      read -p "Enter last name: " LAST_NAME
      read -p "Enter domain: " DOMAIN
      ./5-generate_logins.sh "$FIRST_NAME" "$LAST_NAME" "$DOMAIN"
      ;;
    6)
      ./6-check_users_list.sh "$DOMAIN"
      ;;
    7)
      read -p "Enter the password: " PASSWORD
      ./7-check_password_for_users_list.sh "$PASSWORD" "$DOMAIN"
      ;;
    8)
      read -p "Enter the path to the credentials file: " CREDENTIALS_FILE
      ./8-check_MFA.sh "$CREDENTIALS_FILE"
      ;;
    9)
      read -p "Enter the domain for tenant ID and credentials lookup: " DOMAIN
      ./9-connect_Azure.sh "$DOMAIN"
      ;;
    10)
      ./10-get_access_token.sh
      ;;
    11)
      ./11-get_tokens_azure.sh
      ;;
    12)
      ./12-search_user_mailbox.sh
      ;;
    13)
      ./13-check_condtional_policies.sh 
      ;;
    14)
      ./14-exclude_conditional_access.sh
      ;;
    15)
      ./15-retrieve_teams_messages.sh
      ;;
    16)
      ./16-search_teams_messages.sh
      ;;
    17)
      ./17-enum_azure_subscriptions.sh
      ;;
    18)
      ./18-filter_display_resources.sh
      ;;
    19)
      ./19-azure_info_resource.sh
      ;;
    20)
      ./20-list_resource_group.sh
      ;;
    21)
      ./21-containerapp_resoure.sh
      ;;
    22)
      ./22-containerapp_info.sh
      ;;
    23)
      ./23-KeyVault.sh
      ;;
    24)
      ./24-KeyVault_permission.sh
      ;;
    25)
      ./25-Azure_SQL.sh
      ;;
    26)
      ./26-AzureHound-info.sh
      ;;
    27)
      ./27-Azure_Roadrecon.sh
      ;;


    q)
      echo "Quitting..."
      exit 0
      ;;
    *)
      echo "Invalid option. Please select a valid option."
      ;;
  esac
}

# Check if a domain argument is provided
if [ -z "$1" ]; then
  echo "Usage: $0 <domain>"
  exit 1
fi

# Domain provided by the user
DOMAIN=$1

# Display the logo
display_logo

# Display the menu
display_menu

# Read user choice
read -p "Enter your choice: " CHOICE

# Run the selected script
run_script $CHOICE
