#!/bin/bash

# Define output file paths
OUTPUT_DIR="./13/"
OUTPUT_FILE="${OUTPUT_DIR}conditional_policies.txt"
# Create directory if it doesn't exist
mkdir -p "$OUTPUT_DIR"

# Fetch conditional access policies using GraphRunner
pwsh -Command "
Import-Module /opt/pentestcloud/GraphRunner/GraphRunner.ps1
Invoke-DumpCAPS -Tokens \$tokens | Out-File -FilePath '$OUTPUT_FILE'
"

# Display the raw data file content for debugging
echo "Raw data:"
cat "$OUTPUT_FILE"

