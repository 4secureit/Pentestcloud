#!/bin/bash

# Define output file paths
OUTPUT_DIR="./13/"
OUTPUT_FILE="${OUTPUT_DIR}conditional_policies.txt"
# Create directory if it doesn't exist
mkdir -p "$OUTPUT_DIR"

# Fetch conditional access policies using GraphRunner
pwsh -Command "
Import-Module /opt/pentestcloud/GraphRunner/GraphRunner.ps1
Invoke-DumpCAPS -Tokens \$tokens | Out-File -FilePath '$OUTPUT_FILE'
"

# Display the raw data file content for debugging
echo "Raw data:"
cat "$OUTPUT_FILE"

#./remove_spaces.sh
# Input file path (the file to process)
INPUT_FILE="./13/conditional_policies.txt"

# Output file path (where to save the result)
OUTPUT_FILE="./13/conditional_policies_no_spaces.txt"

# Create directory if it doesn't exist
mkdir -p "$(dirname "$OUTPUT_FILE")"

# Remove all spaces from the input file and save to the output file
tr -d '[:space:]' < "$INPUT_FILE" > "$OUTPUT_FILE"

# Display the result


