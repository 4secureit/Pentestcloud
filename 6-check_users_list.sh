#!/bin/bash

# Check if domain is provided
if [ -z "$1" ]; then
  echo "Usage: $0 <domain>"
  exit 1
fi

DOMAIN=$1

# Define input and output file paths
USER_LIST="./5/${DOMAIN}_logins.txt"
OUTPUT_FILE="./6/${DOMAIN}_users.txt"

# Create the folder ./6 if it doesn't exist
mkdir -p ./6

# Check if the user list file exists
if [ ! -f "$USER_LIST" ]; then
  echo "User list file $USER_LIST not found!"
  exit 1
fi

# Run the Python script to check if users exist, filter only login names
EXISTING_USERS=$(python3 /opt/pentestcloud/o365enum/o365enum.py -u "$USER_LIST" -n 1 -m office.com | grep "1" | cut -d',' -f1)

# Check if any users exist
if [ -n "$EXISTING_USERS" ]; then
  # Display and save the list of existing users
  echo "The following users exist:"
  echo "$EXISTING_USERS"
  echo "$EXISTING_USERS" > "$OUTPUT_FILE"
  echo "Existing users saved to $OUTPUT_FILE"
else
  echo "No existing users found."
fi
