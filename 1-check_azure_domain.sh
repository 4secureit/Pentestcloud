#!/bin/bash

# Check if a domain argument is provided
if [ -z "$1" ]; then
  echo "Usage: $0 <domain>"
  exit 1
fi

# Domain provided by the user
DOMAIN=$1

# Create the output file based on the domain name
DIRECTORY="./1"
OUTPUT_FILE="${DIRECTORY}/1-${DOMAIN}.txt"

# Check if the directory exists, create if not
if [ ! -d "$DIRECTORY" ]; then
  echo "Directory ${DIRECTORY} does not exist. Creating..."
  mkdir -p "$DIRECTORY"
fi


# Redirect all output to the specified file
{
  echo "=== Checking services for domain: $DOMAIN ==="

  # 1. Check DNS records
  echo "1. DNS Records (dig)"
  dig $DOMAIN

  # 2. Check NS (Name Servers) records
  echo "2. NS Records (dig)"
  dig ns $DOMAIN

  # 3. Check WHOIS information
  echo "3. WHOIS Information"
  whois $DOMAIN

  # 4. Check the IP address of the domain
  echo "4. Domain IP Address (dig +short)"
  IP=$(dig +short $DOMAIN)
  echo "IP Address: $IP"

  # 5. Check WHOIS for the IP address
  if [ -n "$IP" ]; then
    echo "5. WHOIS Information for IP Address"
    whois $IP
  else
    echo "No IP address available for the domain."
  fi

  # 6. Check TXT records
  echo "6. TXT Records for domain (SPF, DKIM, etc.)"
  dig txt $DOMAIN

  # 7. Check SSL certificate
  echo "7. SSL Certificate"
  echo | openssl s_client -connect $DOMAIN:443 2>/dev/null | openssl x509 -noout -issuer -subject

  echo "=== End of check for domain: $DOMAIN ==="
} > "$OUTPUT_FILE"

# Inform the user where the results have been saved
echo "Results have been saved to the file: $OUTPUT_FILE"
