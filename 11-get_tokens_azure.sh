#!/bin/bash

# Function to display the menu and get user choice
function display_menu {
    echo "Select the service to get the access token for:"
    echo "1. General Azure Account"
    echo "2. Azure Key Vault"
    echo "3. Azure Resource Manager"
    echo "4. Azure Graph API"
    echo "5. Exit"
    read -p "Enter your choice [1-5]: " choice
}

# Function to get and save the token
function get_and_save_token {
    local resource_url=$1
    local service_name=$2
    local token=$(az account get-access-token --resource "$resource_url" --query accessToken --output tsv)
    local current_date=$(date +"%Y-%m-%d")
    local folder="/11"
    local filename="$folder/token_${service_name}_$current_date.txt"
    
    # Create the folder if it doesn't exist
    if [ ! -d "$folder" ]; then
        mkdir -p "$folder"
    fi

    # Save the token to the file
    echo "$token" > "$filename"
    echo "Token saved to file: $filename"
}

# Main script logic
while true; do
    display_menu
    case $choice in
        1)
            get_and_save_token "" "general_azure_account"
            ;;
        2)
            get_and_save_token "https://vault.azure.net" "azure_key_vault"
            ;;
        3)
            get_and_save_token "https://management.azure.com/" "azure_resource_manager"
            ;;
        4)
            get_and_save_token "https://graph.microsoft.com/" "azure_graph_api"
            ;;
        5)
            echo "Exiting..."
            exit 0
            ;;
        *)
            echo "Invalid choice. Please select again."
            ;;
    esac
done
