#!/bin/bash

# Definiowanie plików wejściowego i wyjściowego
input_file="./13/conditional_policies.txt"
output_file="./13/conditional_exclude.txt"

# Usunięcie pliku wyjściowego, jeśli istnieje
rm -f "$output_file"

# Zmienna pomocnicza do przechwytywania sekcji Exclude
capture_exclude=false

# Wczytywanie zawartości pliku wejściowego
while IFS= read -r line; do
    # Sprawdzanie, czy linia zawiera "Display Name"
    if [[ $line == Display\ Name:* ]]; then
        echo "$line" >> "$output_file"
    fi

    # Sprawdzanie, czy linia zawiera "Exclude"
    if [[ $line == Exclude:* ]]; then
        echo "$line" >> "$output_file"
        capture_exclude=true
        continue
    fi

    # Sprawdzanie, czy linia zawiera "Controls"
    if [[ $line == Controls:* ]]; then
        echo "$line" >> "$output_file"
        echo "" >> "$output_file"  # Dodanie pustej linii dla separacji
        capture_exclude=false
    elif [[ $capture_exclude == true && $line == *:* ]]; then
        # Dodanie wartości Exclude
        echo "$line" >> "$output_file"
    fi
done < "$input_file"

echo "Wyniki zostały zapisane do pliku $output_file"
