#!/bin/bash

# Input file path (the file with no spaces or newlines)
INPUT_FILE="./13/conditional_policies_no_spaces.txt"

# Output file path (where to save the result)
OUTPUT_FILE="./14/extracted_policies_no_spaces.txt"

# Create directory if it doesn't exist
mkdir -p "$(dirname "$OUTPUT_FILE")"

# Initialize output file
echo "Extracted Display Name, Exclude, and Controls:" > "$OUTPUT_FILE"

# Variables to store extracted values
display_name=""
exclude=""
controls=""

# Read the entire input file content as a single line
content=$(cat "$INPUT_FILE")

# Extract Display Name
if [[ "$content" =~ DisplayName:([^P]+) ]]; then
  display_name="${BASH_REMATCH[1]}"
  echo "Display Name: $display_name" >> "$OUTPUT_FILE"
fi

# Extract Exclude (Applications)
if [[ "$content" =~ Exclude:Applications:([^U]+) ]]; then
  exclude="${BASH_REMATCH[1]}"
  echo "Exclude: $exclude" >> "$OUTPUT_FILE"
fi

# Extract Controls
if [[ "$content" =~ Controls:([^=]+) ]]; then
  controls="${BASH_REMATCH[1]}"
  echo "Controls: $controls" >> "$OUTPUT_FILE"
fi

# Display the result
echo "Extracted policies:"
cat "$OUTPUT_FILE"
