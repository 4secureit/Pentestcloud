#!/bin/bash

# Function to display usage instructions
display_usage() {
  echo "Usage: $0 <domain>"
  echo "Example: $0 xyz123.com"
  echo "Note: If your domain is xyz123.com, you should input xyz123"
  echo "The script will automatically handle the part before the first dot."
}

# Check if a domain argument is provided
if [ -z "$1" ]; then
  display_usage
  exit 1
fi

# Domain provided by the user
DOMAIN=$1

# Extract the part of the domain before the first dot
BASE_NAME=$(echo "$DOMAIN" | cut -d '.' -f 1)

# Directory and file names
DIRECTORY="./3"
OUTPUT_FILE="${DIRECTORY}/3-enum-${BASE_NAME}.txt"

# Display information to the user
echo "You have entered the domain: ${DOMAIN}"
echo "The script will use: ${BASE_NAME} as the base name for output files."

# Check if the directory exists, create if not
if [ ! -d "$DIRECTORY" ]; then
  echo "Directory ${DIRECTORY} does not exist. Creating..."
  mkdir -p "$DIRECTORY"
fi

# Command to run azsubenum
COMMAND="python3 /opt/pentestcloud/AzSubEnum/azsubenum.py -b ${BASE_NAME} --thread 10"

# Run the command and capture the output
echo "Running command: $COMMAND"
RESULT=$(eval $COMMAND)

# Display the result
echo "$RESULT"

# Save the result to the output file
echo "$RESULT" > "$OUTPUT_FILE"

# Inform the user where the results have been saved
echo "Results have been saved to the file: $OUTPUT_FILE"
