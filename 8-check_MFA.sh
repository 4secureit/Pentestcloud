#!/bin/bash

# Script to display PowerShell commands for Invoke-MFASweep and API authentication

# Check if the user provided the input file
if [ -z "$1" ]; then
  echo "Usage: $0 <credentials_file>"
  exit 1
fi

# Input file containing usernames and passwords
CREDENTIALS_FILE=$1

# Check if the file exists
if [ ! -f "$CREDENTIALS_FILE" ]; then
  echo "Error: File '$CREDENTIALS_FILE' not found."
  exit 1
fi

# Display PowerShell commands for each username and password
echo "Generating PowerShell commands for usernames and passwords from $CREDENTIALS_FILE:"
while IFS=':' read -r USERNAME PASSWORD; do
  if [ -n "$USERNAME" ] && [ -n "$PASSWORD" ]; then
    echo "PowerShell Commands for $USERNAME:"
    echo "--------------------------------------------------"
    echo "Import-Module /opt/pentestcloud/MFASweep/MFASweep.ps1"
    echo "Invoke-MFASweep -Username '$USERNAME' -Password '$PASSWORD' -Recon -IncludeADFS"
    echo "Invoke-GraphAPIAuth -Username '$USERNAME' -Password '$PASSWORD'"
    echo "Invoke-AzureManagementAPIAuth -Username '$USERNAME' -Password '$PASSWORD'"
    echo
  else
    echo "Invalid line format in $CREDENTIALS_FILE"
  fi
done < "$CREDENTIALS_FILE"

echo "You can now manually copy and paste these commands into PowerShell."
echo "Press Enter to exit the script."
read
