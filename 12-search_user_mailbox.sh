#!/bin/bash

# Function to display the instructions for using GraphRunner
display_instructions() {
  echo "======================================"
  echo "         4SECUREIT.PL                 "
  echo "======================================"
  echo "Using GraphRunner to search mailbox contents."
  echo
  echo "Follow the steps below to use GraphRunner for mailbox search (substring search included):"
  echo
  echo "Step 1: Import the GraphRunner PowerShell module"
  echo "-----------------------------------------------"
  echo "   Run the following command in PowerShell:"
  echo
  echo "   Import-Module /opt/pentestcloud/GraphRunner/GraphRunner.ps1"
  echo
  echo "Step 2: Obtain the necessary Graph API tokens"
  echo "--------------------------------------------"
  echo "   Run the following command to get your Graph API tokens:"
  echo
  echo "   \$tokens = Get-GraphTokens"
  echo
  echo "   Alternatively, if you have a saved token file, you can load it like this:"
  echo
  echo "   \$tokens = Get-Content '/11/token_azure_.......txt'"
  echo
  echo "Step 3: Perform a mailbox search for the specified keyword"
  echo "---------------------------------------------------------"
  echo
  # Prompt user for search term
  read -p "Enter the keyword(s) to search in the mailbox (e.g., 'pass' will return 'password'): " SEARCH_TERM

  # Prompt user for message count
  read -p "Enter the number of messages to return (default is 40): " MESSAGE_COUNT

  # Default message count to 40 if not provided
  if [ -z "$MESSAGE_COUNT" ]; then
    MESSAGE_COUNT=40
  fi

  echo "   To search the mailbox for the specified keyword(s), run the following command:"
  echo
  echo "   Invoke-SearchMailbox -Tokens \$tokens -SearchTerm '*$SEARCH_TERM*' -MessageCount $MESSAGE_COUNT"
  echo
  echo "   Note: The asterisks (*) before and after the search term allow substring matching, so"
  echo "   entering 'pass' will also match 'password', 'passing', etc."
  echo
  echo "======================================"
  echo "Instructions complete. You can now perform the search."
}

# Execute the instruction display function
display_instructions
