#!/bin/bash

# Function to display the logo
display_logo() {
  echo "======================================"
  echo "         4SECUREIT.PL                 "
  echo "======================================"
  echo "Cybersecurity & IT Solutions - by : WILAN"
  echo
}

# Function to display login options
display_menu() {
  echo
  echo "Choose the login method:"
  echo "======================================"
  echo "1. Login using 'az login'"
  echo "2. Login using 'Connect-AzAccount' in PowerShell"
  echo "q. Quit"
  echo "======================================"
  echo
}

# Function to read user input for tenant and credentials
load_credentials() {
  DOMAIN=$1

  # Load tenant ID from file if exists
  if [[ -f "./2/2-$DOMAIN.txt" ]]; then
    TENANT_ID=$(cat "./2/2-$DOMAIN.txt")
  else
    TENANT_ID=""
  fi

  # Load username and password from credentials file
  if [[ -f "./7/${DOMAIN}_credentials.txt" ]]; then
    USERNAME=$(awk -F: '{print $1}' "./7/${DOMAIN}_credentials.txt")
    PASSWORD=$(awk -F: '{print $2}' "./7/${DOMAIN}_credentials.txt")
  else
    echo "Credentials file './7/${DOMAIN}_credentials.txt' not found."
    exit 1
  fi
}

# Function to display 'az login' command
az_login_command() {
  echo
  echo "Command to login with 'az login':"
  echo "----------------------------------"
  if [[ -n "$TENANT_ID" ]]; then
    echo "az login -u '$USERNAME' -p '$PASSWORD' --tenant '$TENANT_ID'"
    echo "az login --use-device-code"
  else
    echo "az login -u '$USERNAME' -p '$PASSWORD'"
  echo "az login --use-device-code"
  fi
}

# Function to display 'Connect-AzAccount' command for PowerShell
connect_azaccount_command() {
  echo
  echo "Command to login with 'Connect-AzAccount' in PowerShell:"
  echo "-------------------------------------------------------"
  echo "pwsh"
  echo "Import-Module Az"
  if [[ -n "$TENANT_ID" ]]; then
    echo "Connect-AzAccount -Username '$USERNAME' -Password '$PASSWORD' -TenantId '$TENANT_ID'"
    echo " "
    echo  "Connect-AzAccount -UseDeviceAuthentication" 	 
else
  echo "Connect-AzAccount -Username '$USERNAME' -Password '$PASSWORD'"
  echo " " 
  echo  "Connect-AzAccount -UseDeviceAuthentication" 
  fi
}

# Main script execution

# Check if a domain argument is provided
if [ -z "$1" ]; then
  echo "Usage: $0 <domain>"
  exit 1
fi

# Domain provided by the user
DOMAIN=$1

# Display the logo
display_logo

# Load the credentials and tenant ID from files
load_credentials "$DOMAIN"

# Display the menu
display_menu

# Read user choice
read -p "Enter your choice: " CHOICE

# Execute based on user choice
case $CHOICE in
  1)
    az_login_command
    ;;
  2)
    connect_azaccount_command
    ;;
  q)
    echo "Quitting..."
    exit 0
    ;;
  *)
    echo "Invalid option. Please select a valid option."
    ;;
esac
