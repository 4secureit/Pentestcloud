#!/bin/bash

# Define input and output file paths
INPUT_FILE="./15/teams.txt"
OUTPUT_FILE="./16/search_teams.txt"

# Create the output directory if it doesn't exist
mkdir -p "$(dirname "$OUTPUT_FILE")"

# Check if the input file exists
if [[ ! -f "$INPUT_FILE" ]]; then
  echo "Input file $INPUT_FILE not found."
  exit 1
fi

# Prompt the user to enter the word to search for
read -p "Enter the word to search for: " search_word

# Initialize an empty result file
> "$OUTPUT_FILE"

# Search for messages containing the word and save them to the output file
awk -v keyword="$search_word" '
  BEGIN { message = "" }
  {
    if ($0 == "") {
      if (message ~ keyword) {
        print message > "'$OUTPUT_FILE'"
        print "" > "'$OUTPUT_FILE'"  # Add a blank line between messages
      }
      message = ""
    } else {
      message = message $0 "\n"
    }
  }
  END {
    if (message ~ keyword) {
      print message > "'$OUTPUT_FILE'"
    }
  }
' "$INPUT_FILE"

# Display the results
if [[ -s "$OUTPUT_FILE" ]]; then
  echo "Messages containing '$search_word' have been saved to $OUTPUT_FILE:"
  cat "$OUTPUT_FILE"
else
  echo "No messages found containing the word '$search_word'."
fi
