# Penetration Testing Scripts Collection

## Overview

This repository is a collection of custom Bash and PowerShell scripts designed for penetration testing, domain enumeration, and security analysis within Azure and Office 365 environments. The scripts target tasks such as domain management checks, token extraction, user existence verification, and conditional access policy analysis. They are intended for use on Kali Linux, leveraging Azure CLI, Graph API, and Microsoft-specific tools to streamline testing in cloud environments.

Each script focuses on automating critical tasks within these platforms, providing insights into user authentication, access control policies, and communication security.

## Scripts Included

## 0. **Check if Domain is Managed in Azure**
   - **Script**: `0-check_domain_azure.sh`
   - **Description**: This script checks whether a specified domain is managed in Azure by querying the Microsoft login service.

## 1. **DNS and DIG Check**
   - **Script**: `1-check_azure_domain.sh`
   - **Description**: Performs DNS and DIG queries to verify the domain's configuration and details.

## 2. **Tenant ID Lookup**
   - **Script**: `2-check-tenant-id.sh`
   - **Description**: Retrieves the Azure tenant ID associated with the provided domain.

## 3. **Azure Subdomain Enumeration**
   - **Script**: `3-enum-subdomain.sh`
   - **Description**: Enumerates Azure services for subdomains related to a given domain.

## 4. **Check if Office 365 User Exists**
   - **Script**: `4-check-o365-user.sh`
   - **Description**: Verifies if an Office 365 user exists by checking their login in the Office 365 environment.

## 5. **Generate Login List from Name and Domain**
   - **Script**: `5-generate_logins.sh`
   - **Description**: Generates a list of possible login variations based on the userâ€™s name and domain. The list is saved to a file for further use.

## 6. **Check Users from List**
   - **Script**: `6-check_users_list.sh`
   - **Description**: Checks if users from a generated login list exist in Office 365 and saves the results to a specified file.
     
### 7. **Check User Passwords and Save Valid Ones**
   - **Script**: `7-check_password_for_users_list.sh`
   - **Description**: Validates passwords for users from a provided list and saves valid login-password pairs to a file. The script checks each password against the list of users and stores results for further analysis.

### 8. **Generate PowerShell Commands for MFA Sweep and API Authentication**
   - **Script**: `8-check_MFA.sh`
   - **Description**: Generates PowerShell commands for performing MFA sweeps and authenticating via Microsoft Graph API and Azure Management API. The script reads from a file containing usernames and passwords, and provides commands for importing the MFASweep module and running `Invoke-MFASweep`, `Invoke-GraphAPIAuth`, and `Invoke-AzureManagementAPIAuth`.

## 9. **Generate Azure Login Commands**

- **Script**: `**9-connect_Azure.sh**`
- **Description**: This script displays Azure login commands for both `az login` and `Connect-AzAccount`. It retrieves the Tenant ID and credentials from specified files, and generates the necessary login commands with the provided data. The script ensures that the required files are present, extracts the necessary information, and then outputs the commands with placeholders replaced by actual values.

## 10. Token Extraction and Saving Script
- **Script**: `**10-get_access_token.sh**`
- **Description**:This script retrieves the access token from Azure CLI and saves it to a file in the `/10/` directory. The filename includes the current date, and the script ensures that the directory exists or creates it if necessary.

## 11 Token Extraction Script
- **Script**: `**11-get_tokens_azure.sh**`
- **Description**:This script allows you to obtain access tokens from different Azure services and save them to files in the `/11/` directory. It provides a menu for selecting the desired service and handles token retrieval and file management.


### Services

   1. **General Azure Account**: Retrieves a token for general Azure account access.
   2. **Azure Key Vault**: Retrieves a token for accessing Azure Key Vault resources.
   3. **Azure Resource Manager**: Retrieves a token for managing Azure resources.
   4. **Azure Graph API**: Retrieves a token for accessing Microsoft Graph API.

## 12. **Mailbox Search Script**

- **Script**: `**12-search_user_mailbox.sh**`
- **Description**:This script provides guidance for running the GraphRunner tool to search a mailbox for specified terms. It retrieves the necessary tokens and displays the command for the user to execute the search, saving results to a file.

## 13. **Conditional Policy Extraction Script**
- **Script**: `** 13-check_condtional_policies.sh**`
- **Description**: This script retrieves conditional access policies using GraphRunner, saves them to a file

## 14. **Conditional Policy Filtering Script**
- **Script**: `** 14-exclude_conditional_access.sh**`
- **Description**:This script filters out policies that do not enforce MFA. The filtered list is saved separately in the /14/ directory for review.

## 15. **Teams Messages Retrieval and Token Handling Script**
- **Script**: `**15-Search_MSTeams.sh**`
- **Description**:This PowerShell script retrieves tokens for Microsoft Teams messages using multiple modules. It uses Get-GraphTokens to obtain the tokens and then loads AADInternals to retrieve Teams messages. The results are displayed in the console, and they are also saved to the ./15/teams.txt file for later analysis.

The final command for fetching Teams messages must be run manually by the user

## 16. Teams Message Search Script
- **Script**: `**16-search_teams.sh**`
- **Description**:This Bash script searches through the messages stored in the ./15/teams.txt file for a specified keyword. It looks for entire messages that contain the search term and writes them to the ./16/search_teams.txt file. Users are prompted to enter the keyword, and the script ensures all matching messages are saved and displayed for review.
## 17. Enumerate Azure Subscriptions

**Script:** `**17-enum_azure_subscriptions.sh**`

**Description:** This script lists all Azure subscriptions available to the user. It saves the subscription information to a file for further analysis.

## 18 Filter and Display Azure Resources by Resource Group
**Script:** `**./18-filter_display_resources.sh**`  
**Description:** This script filters Azure resources by their resource group and displays the results in a formatted table. It first extracts the resource groups from the resource list and then displays resources grouped by these resource groups.

## 19 Display and Save Resources Grouped by Resource Group
**Script:** `**./19-group_resources.s**`  
**Description:** This script retrieves the list of all Azure resources and saves it to a file. It then groups these resources by their resource group and name, displaying the grouped results in a table format. The output is saved to a file for detailed review.

## 20 Display and Save Azure Resources in a Specific Resource Group
**Script:** `**./20-display_resources_in_group.sh**`  
**Description:** This script allows the user to select a specific resource group and retrieves all Azure resources within that group. The results are displayed in a table format and saved to a file for record-keeping.
## 21 Display and Save Azure Container Apps in a Specific Resource Group
**Script:** `**/21-display_container_apps.sh**`  
**Description:** This script retrieves and displays all Azure container apps within a specified resource group. It also saves the list of container apps to a file for further review
## 22 Display and Save Container App Details
**Script:** `**22-containerapp_info.sh**`  
**Description:** This option allows you to view and save detailed information about a specific Azure Container App within a chosen resource group.


## Usage

To use the scripts, run the main menu:

```bash
./menu.sh <domain>
```

The menu provides options to run each of the scripts for the specified domain, along with prompts for additional input when necessary (e.g., user name or email).

### Example

```bash
./menu.sh example.com
```

You will be presented with a menu of actions related to the domain. Simply choose the desired option and follow the instructions.

## Requirements

- **Kali Linux**: These scripts are optimized for use on Kali Linux.
- **Python 3**: Ensure Python 3 is installed for scripts that rely on Python.
- **Azure/Office 365 Enumeration Tools**: The repository uses several tools (e.g., `/opt/pentestcloud/o365enum/`) for enumerating Azure services and Office 365 logins.

## Installation

1. Clone this repository:

    ```bash
    git clone https://github.com/4secureit/Pentestcloud.git
    ```

2. Navigate to the folder:

    ```bash
    cd Pentestcloud
    ```

3. Ensure all scripts are executable:

    ```bash
    chmod +x *.sh
    ```

4. Run the menu script to start using the tools:

    ```bash
    ./menu.sh <domain>
    ```
---
## Author

Developed and maintained by **WILAN** at 4SecureIT.pl.
```
